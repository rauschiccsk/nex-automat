version: "3.8"

services:
  invoice-worker:
    build:
      context: C:/opt/nex-automat-src/apps/supplier-invoice-worker
      dockerfile: Dockerfile
    container_name: mager-invoice-worker
    restart: unless-stopped
    environment:
      - TEMPORAL_HOST=host.docker.internal
      - TEMPORAL_PORT=7233
      - POSTGRES_HOST=host.docker.internal
      - POSTGRES_PORT=5432
      - FASTAPI_URL=http://host.docker.internal:8001
    networks:
      - nex-mager
    extra_hosts:
      - "host.docker.internal:host-gateway"

  polling-scheduler:
    build:
      context: C:/opt/nex-automat-src/apps/supplier-invoice-worker
      dockerfile: Dockerfile
    container_name: mager-polling-scheduler
    command: ["python", "-m", "scheduler.polling_scheduler"]
    restart: unless-stopped
    environment:
      - TEMPORAL_HOST=host.docker.internal
      - TEMPORAL_PORT=7233
      - POSTGRES_HOST=host.docker.internal
      - POSTGRES_PORT=5432
    networks:
      - nex-mager
    extra_hosts:
      - "host.docker.internal:host-gateway"

networks:
  nex-mager:
    name: nex-mager
    driver: bridge
